From 1b06225458fef654145ee91fa4ed038ec5faf008 Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Wed, 23 Mar 2011 19:17:26 -0500
Subject: [PATCH 2/3] Revert "oom: suppress show_mem() for many nodes in irq context on page alloc failure"

This reverts commit 29423e77c06cee7d4e335ef4a7cbd949da978c91.
---
 mm/page_alloc.c |   17 +----------------
 1 files changed, 1 insertions(+), 16 deletions(-)

diff --git a/mm/page_alloc.c b/mm/page_alloc.c
index 47e4b42..c14d614 100644
--- a/mm/page_alloc.c
+++ b/mm/page_alloc.c
@@ -1717,20 +1717,6 @@ try_next_zone:
 	return page;
 }
 
-/*
- * Large machines with many possible nodes should not always dump per-node
- * meminfo in irq context.
- */
-static inline bool should_suppress_show_mem(void)
-{
-	bool ret = false;
-
-#if NODES_SHIFT > 8
-	ret = in_interrupt();
-#endif
-	return ret;
-}
-
 static inline int
 should_alloc_retry(gfp_t gfp_mask, unsigned int order,
 				unsigned long pages_reclaimed)
@@ -2178,8 +2164,7 @@ nopage:
 			" order:%d, mode:0x%x\n",
 			current->comm, order, gfp_mask);
 		dump_stack();
-		if (!should_suppress_show_mem())
-			show_mem();
+		show_mem();
 	}
 	return page;
 got_pg:
-- 
1.7.1

