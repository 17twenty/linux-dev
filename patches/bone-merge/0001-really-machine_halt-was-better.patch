From b3e5634dc536ab9a8bbbc0fadfc027d80920dcd1 Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Thu, 8 Mar 2012 15:06:35 -0600
Subject: [PATCH] really, machine_halt was better?

Signed-off-by: Robert Nelson <robertcnelson@gmail.com>
---
 arch/arm/mach-omap2/board-am335xevm.c |   22 +++++++++++-----------
 1 files changed, 11 insertions(+), 11 deletions(-)

diff --git a/arch/arm/mach-omap2/board-am335xevm.c b/arch/arm/mach-omap2/board-am335xevm.c
index 23374c7..87a52fc 100644
--- a/arch/arm/mach-omap2/board-am335xevm.c
+++ b/arch/arm/mach-omap2/board-am335xevm.c
@@ -2550,18 +2550,18 @@ static void am335x_evm_setup(struct memory_accessor *mem_acc, void *context)
 	return;
 
 out:
-	/*
-	 * If the EEPROM hasn't been programed or an incorrect header
-	 * or board name are read then the hardware details are unknown.
-	 * Notify the user and call machine_halt to stop the boot process.
+
+	pr_err("Could not detect any board, falling back to: "
+		"Beaglebone (< Rev A3) with no daughter card connected\n");
+	daughter_brd_detected = false;
+	setup_beaglebone_old();
+
+	/* Initialize cpsw after board detection is completed as board
+	 * information is required for configuring phy address and hence
+	 * should be call only after board detection
 	 */
-	pr_err("The error message above indicates that there is an issue with\n"
-		   "the EEPROM or the EEPROM contents.  After verifying the EEPROM\n"
-		   "contents, if any, refer to the %s function in the\n"
-		   "%s file to modify the board\n"
-		   "initialization code to match the hardware configuration\n",
-		   __func__ , __FILE__);
-	machine_halt();
+
+	am33xx_cpsw_init(gigabit_enable);
 }
 
 static struct at24_platform_data am335x_daughter_board_eeprom_info = {
-- 
1.7.9.1

